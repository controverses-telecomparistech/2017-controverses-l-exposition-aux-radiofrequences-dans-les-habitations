/**
 * Package www/live2
 * lmd/module/live2/page
 * lmd/module/live2/providers/scribblelive
 * lmd/util/url-tools
 * lmd/ui/sharing
 * lmd/module/live2/page/comment-form
 * lmd/module/live2/page/events
 * lmd/module/live2/page/formatters
 * lmd/module/live2/page/store
 * lmd/module/live2/providers/scribblelive/conf
 * lmd/module/live2/providers/scribblelive/api
 */

/* -- start module lmd/module/live2/page -- */
define("lmd/module/live2/page",["jquery","hoganpower!/partials/element/live2/popin.html.mu@www","lmd/ui/slideshow","lib/moment/langs/fr","lmd/util/url-tools","lmd/module/xiti/hit","lmd/module/live2/page/events","lmd/module/live2/page/formatters","lmd/module/live2/page/store","lmd/module/live2/page/comment-form","lib/moment/core/2.0.0/moment","lib/jquery/plugin/jquery.spin"],function($,t,e,n,o,i,l,a,s,r){"use strict";function c(){var t=document.getElementsByClassName("initial-posts");t&&t.length&&(t=t[0],t.parentNode.removeChild(t))}var d=$.getScript("https://platform.twitter.com/widgets.js"),u=$.getScript("//platform.instagram.com/fr_FR/embeds.js");moment.lang("fr",n);var p,m,f,v,h,g,w,b,P,C,y,B=null,T=$(".live2-container"),k=!1,D={$globalScrollElement:$("html,body"),$toolbar:$(".live-toolbar",T),$body:$(".live-body",T),$postsContainer:$(".live-body .posts",T),$newPostsContainer:$(".new-posts",T),$factsContainer:$(".facts-content",T),$participationButton:$(".live-toolbar .participation-button",T),$topPageButton:$(".live-toolbar .top-page-button",T),$liveContent:$(".live-content",T),$liveContentTab:$("[data-content-class=live-content]",T),$oldPostsContainer:$(".old-posts",T),$newPostsButton:$(".new-posts-button",T),$newPostsScroll:$("#js-new-post-scroll",T),$oldPostsButton:$(".old-posts-button",T),$postCommentContainer:$(".post-comment-container",T),$postCommentPlaceholder:$(".post-comment-placeholder",T),$livePageHeader:$(".header"),$livePageTitle:$(".js-live-page-title"),$livePageDescription:$(".js-live-page-description"),$livePageMediaAppel:$("#js-live-page-media-appel")},E=r.getPluggedForm(D.$postCommentContainer,k),S=T.offset().top,x=function(){var t=!1;return function(){return t?t:t=0!==D.$newPostsContainer.find(".post:visible").length}}(),A=function(){var t=0,e=[{quick:"",full:""},{quick:"Nouveau contenu",full:"Voir la nouvelle actualité"},{quick:"Nouveaux contenus",full:"Voir les ${n} nouveaux contenus"}];return{refresh:function(){var n=s.newPostCount.get();n>1?(t=2,e[t].full=e[t].full.replace(/(\${n}|\d+)/,n)):t=n,C(),y()},get:function(n){return e[t][n]}}}();C=function(){D.$newPostsButton.html(A.get("full"))},y=function(){var t=!1,e=!1,n=D.$postsContainer.position()?D.$postsContainer.position().top+600:0;return function(){return e=$(window).scrollTop()>n,!t&&e?(t=!0,window.requestAnimationFrame(function(){D.$newPostsScroll.html(A.get("quick"))})):t&&!e?(t=!1,window.requestAnimationFrame(function(){D.$newPostsScroll.html("")})):void 0}}();var _=function(){T.on("click",".tab",function(){f($(this))}),S===$(window).scrollTop()?D.$toolbar.addClass("fixed"):$(window).bind("scroll",function(){$(window).scrollTop()>=S?D.$toolbar.addClass("fixed"):D.$toolbar.removeClass("fixed")}),D.$participationButton.on("click",function(){i.hit(this,"C","","Live::Participer","A"),E.$container.is(":hidden")?(f(D.$liveContentTab),E.$container.fadeIn()):D.$globalScrollElement.animate({scrollTop:E.$container.offset().top-D.$toolbar.height()},1e3)}),D.$topPageButton.on("click",function(){i.hit(this,"C","","Live::Haut_de_Page","A"),D.$globalScrollElement.animate({scrollTop:0},1e3)}),$("body").on("click",T.selector+" .close-popin",function(){$($(this).data("close-popin-target")).fadeOut(function(){$(this).data("close-popin-remove")&&$(this).remove()})}),D.$newPostsButton.on("click",function(){v()}),D.$newPostsScroll.on("click",function(){return D.$globalScrollElement.animate({scrollTop:D.$body.offset().top-50},800),v(),!1}),$(window).on("scroll",y),D.$oldPostsButton.on("click",function(){i.hit(this,"C","","Live::Voir_Plus","A"),D.$oldPostsContainer.find(".post").fadeIn(),D.$oldPostsButton.hide(),l.send("oldPostsDisplayed")})},I=T.get(0).getElementsByClassName("refresh-time"),j=/à [0-9]{2}h[0-9]{2}/g,q=function(){for(var t,e,n=I.length;n;)n--,e=$(I[n]),t=a.getDisplayedDate(moment(new Date(e.data("time"))),e.hasClass("full-time-format")),e.html(t),t.search(j)!==-1&&e.removeClass("refresh-time");p(),window.setTimeout(q,5e3)},N=function(){$.getJSON("/ws/1/live/"+lmd.context.element.id+"/").done(function(t){var e,n=D.$livePageMediaAppel.find("img"),o=t.live.element_data.titre||t.live.titre;return o&&(D.$livePageTitle.html(o),window.document.title=o),t.live.description&&D.$livePageDescription.html(t.live.description),t.live.multimedia_appel&&t.live.multimedia_appel.src&&n.src!==t.live.multimedia_appel.src?(e=document.createElement("img"),e.src=t.live.multimedia_appel.src,e.alt=t.live.multimedia_appel.alt,e.title=t.live.multimedia_appel.title,void e.addEventListener("load",function(){D.$livePageMediaAppel.removeClass("en-attente"),n.replaceWith(e),D.$livePageHeader.css("visibility","visible")})):D.$livePageHeader.css("visibility","visible")}).always(window.setTimeout.bind(null,N,6e4))};p=function(){function t(t){t!==a.getDayId(moment())&&$(".post[data-day-id="+t+"]:first",D.$body).addClass("last-post-of-day")}s.days.backwardIterate(t)};var F=function(t,e){e.posts.forEach(function(t){var e=s.postIds.push(t.id);e&&s.newPostCount.add(1)}),h(e.posts,D.$newPostsContainer),x()||v()},H=function(t){for(var e=t.getElementsByClassName("tweet"),n="",o=e.length;o;)o--,n=e[o].getAttribute("data-tweet-id"),""!==n&&twttr.widgets.createTweet(n,e[o])},L=function(t){for(var n,o,i=$(t).find(".slider"),l=i.length;l;)l--,n=$(i[l]),o={$container:n,$content:$(".content",n),$nav:$("nav",n),$navPrev:$(".previous",n),$navNext:$(".next",n),actifPrevNext:"active",$navDotContainer:null,autoSlideOn:0,numberDisplayBlock:1,infini:!0},e().init(o),n.on("pageDisplayed",m)};m=function(t,e){$(t.currentTarget).find(".counter").text(e.vals.currentPage+" sur "+e.vals.totalPage)};var M=function(t,e){g(e.posts,D.$oldPostsContainer),D.$oldPostsButton.fadeIn()},O=function(t,e){w(e.posts)},V=function(t,e){D.$factsContainer.html(e.content)},R=function(t,e){0===e.display?(D.$participationButton.animate({width:"0"}),E.$container.animate({height:"0",opacity:0},function(){D.$liveContent[0].style.visibility="visible"}),D.$postCommentPlaceholder.animate({height:"auto",opacity:1})):(D.$participationButton.animate({width:"auto"}),E.$container.animate({height:"auto",opacity:1},function(){D.$liveContent[0].style.visibility="visible"}),D.$postCommentPlaceholder.animate({height:"0",opacity:0}))};f=function(t){for(var e=T.find(".tab"),n=e.length;n;)n--,T.find("."+$(e[n]).data("content-class")).hide(),$(e[n]).removeClass("active");T.find("."+t.data("content-class")).show(),t.addClass("active")},v=function(){s.newPostCount.reset(),A.refresh(),D.$newPostsContainer.find(".post").fadeIn()},h=function(t,e){var n,o,i=[],l=[];t.forEach(function(t){n=P(t.id),null===n?(n=a.createPost(t),n.hide(),l.push(n),i.push(n)):(o=a.createPost(t),n.data("hash")!==o.data("hash")&&(n.html(o.html()),l.push(n)))}),e.prepend(i),b(l),A.refresh()},g=function(t,e){for(var n,o=[],i=0,s=t.length,r=!1;i<s;i++)null===P(t[i].id)&&(r=!0,n=a.createPost(t[i]),n.hide(),o.push(n));r?(e.append(o),b(o)):l.send("oldPostsDisplayed")},w=function(t){for(var e,n=t.length;n;)n--,e=P(t[n].id),null!==e&&e.remove()},b=function(t){d.done(function(){for(var e=t.length;e;)e--,H(t[e][0])}),u.done(function(){window.instgrm.Embeds.process()});for(var e=t.length;e;)e--,L(t[e][0]);p()},P=function(t){var e=document.getElementById("post-"+t);return e?$(e):null};var z=function(e){var n,o;B.getPostData(e).done(function(){this.post&&(this.post.fullTimeFormat=!0,n=a.createPost(this.post),o=$(t.render()),o.find(".content").append(n),o.find(".live-title").append($("body").find(".live-toolbar .live-title").html()),$("body").append(o),b([n]))})};return{start:function(t,e,n){k=n;var i,a=null;B=t,i=o.parseQueryString(document.location.search.substr(1)),i.labels&&(a=decodeURIComponent(i.labels).split(",")),_(),k?$("body").addClass("call-for-evidence"):(c(),l.listen("newPostsAvailable",F),l.listen("oldPostsAvailable",M),l.listen("postsDeleted",O)),l.listen("newFactsContent",V),l.listen("displayCommentForm",R),B.pageInitialization(e,a),i.highlight&&z(i.highlight),""!==D.$factsContainer.html()&&B.refreshFactsContent(),q(),N()}}});
/* -- end module lmd/module/live2/page -- */
/* -- start module lmd/module/live2/providers/scribblelive -- */
define("lmd/module/live2/providers/scribblelive",["jquery","lmd/module/live2/providers/scribblelive/conf","lmd/module/live2/providers/scribblelive/api","lmd/module/live2/page/events","lmd/module/live2/page/formatters","lib/moment/core/2.0.0/moment"],function($,e,t,n,o){"use strict";function a(t){var n,o,a="",i="";return(n=t.match(e.aTagRegexKeepLink))&&(o=t.match(e.imgTagRegex))?(a=o[0].replace("<img ",'<img class="block" '),i='<a href="'+n[1]+'" class="bord0">'+a+"</a>",t.replace(o[0],i)):t}var i,r,s="",d=!0,l=null,c={id:null,revisionId:null,refreshRate:e.factsRefreshDelay},g=null,m=!0,u=function(e){void 0!==e.IsCommenting&&g!==e.IsCommenting&&(g=e.IsCommenting,n.send("displayCommentForm",{display:g})),void 0!==e.IsLive&&(m=1===e.IsLive,!m&&r&&window.clearTimeout(r))},p=function(){var o,a,r=t.page.getModified().getTime()===new Date(0).getTime();a=r?t.getPage():t.getPostsSince(moment(t.page.getModified()).utc().format("YYYY/M/D H:m:ss")),a.done(function(e){var a=0;if(u(e),o=D(e),o.adds.length<=0&&t.page.get()>0&&r)t.page.next(),p();else{for(t.page.setModified(M(e.LastModified)),a=o.adds.length;a;)a--,o.adds[a].createdAt<i&&o.adds.splice(a,1);o.adds.length>0&&(n.send("newPostsAvailable",{posts:o.adds}),null===i&&(i=o.adds[o.adds.length-1].createdAt))}d&&(d=!1,f()),o.deletes.length>0&&n.send("postsDeleted",{posts:o.deletes})}).always(function(){m&&window.setTimeout(p,e.postsRefreshRate)})},f=function(){var e;return 0!==t.page.get()&&(e=t.getPage().done(function(e){var o=D(e);return t.page.next(),e.posts=o,o.adds.length>0?(n.send("oldPostsAvailable",{posts:o.adds}),i=o.adds[o.adds.length-1].createdAt):f(),e})),e?e:$.Deferred().reject()},v=function(e){if(null===l)return!0;if(!e.tags)return!1;for(var t,n=l.length;n;)for(t=e.tags.length,n--;t;)if(t--,e.tags[t].name.toUpperCase()===l[n].toUpperCase())return!0;return!1},h=function(e){return t.getPostData(e).done(function(e){this.post=w(e)})},C=function(){t.getEvent().done(function(e){e.LiveArticle&&c.id!==e.LiveArticle&&(c.id=e.LiveArticle),null!==c.id&&x()})},x=function(){var o=!1;return t.getLiveArticle(c.id).done(function(t){t.Id&&t.Html&&(o=""===t.Html.replace(e.htmlTagsRegex,""),c.revisionId===t.Id||null===c.revisionId&&o||(c.revisionId=t.Id,n.send("newFactsContent",{content:t.Html}))),!o&&m&&(r=window.setTimeout(x,c.refreshRate))})},M=function(t){var n=t.match(e.dateRegex);return null!==n?new Date(parseInt(n[1],10)):null},D=function(e){var t={adds:[],deletes:[]};return e.Posts&&(t.adds=y(e.Posts)),e.Edits&&(t.adds=$.merge(t.adds,y(e.Edits))),e.Deletes&&(t.deletes=y(e.Deletes)),t.adds.sort(function(e,t){return t.createdAt-e.createdAt}),t},y=function(e){for(var t,n=[],o=e.length;o;)o--,t=w(e[o]),null!==t&&v(t)&&(n[n.length]=t);return n},w=function(t){var n,o={id:t.Id,type:t.Source.replace(e.htmlTagsRegex,"").toLowerCase(),createdAt:M(t.Created),author:{name:t.Creator.Name,avatar:t.Creator.Avatar},content:String.prototype.replace.apply(t.Content,e.blacklistAttributes),tags:[]};return t.Icons&&(t.Icons.forEach(function(e){e.Name&&e.TextColor&&e.Color&&(o.isUrgent=o.isUrgent||"urgent"===e.Name.toLowerCase(),o.tags.push({name:e.Name,bgColor:e.Color,color:e.TextColor}))}),o.hasTags=!!o.tags.length),""===o.type&&(o.type=t.Type.toLowerCase()),"twitter"===o.type?(n=e.tweetIdRegex.exec(t.Source),n&&n[1]&&(o.content=I(n))):"instagram"===o.type?(n=e.instagramPostIdRegex.exec(t.Source),n&&n[1]&&(o.content=b(n))):"image"===o.type?t.Media&&t.Media.length>0&&(o.content=A(t.Media,t.Content)):(o.content=T(o.content,{string:"blockquote",type:"tag"},e.commentBlockquoteRegex,R,{postDate:o.createdAt}),o.content=T(o.content,{string:"sltc-twitter",type:"class"},e.tweetIdRegex,I),o.content=T(o.content,{string:"twitter-tweet",type:"class"},e.tweetIdRegex,I),o.content=T(o.content,{string:"Media",type:"class"},e.instagramPostIdRegex,b),o.content=T(o.content,{string:"scrbbl-post-embed",type:"class"},e.instagramPostIdRegex,b),0===o.content.indexOf("<iframe ")&&(o.content='<div class="Media">'+o.content+"</div>"),t.Media&&t.Media.length>0&&(o.content+=A(t.Media)),o.content.indexOf('class="scrbbl-sitePreview"')!==-1&&(o.content=a(o.content)),o.content=S(o.content),o.content=o.content.replace(e.aTagRegex,'<a target="_blank" ')),o},T=function(t,n,o,a,i){var r;if("tag"===n.type?r="<"+n.string+"[^>]*>":"class"===n.type&&(r=e.getClassnameRegex(n.string),n.string="."+n.string),!t.match(r))return t;for(var s,d,l=$("<div>"+t+"</div>"),c=l.find(n.string),g=c.length;g;)g--,s=o.exec(c[g].innerHTML||c[g].outerHTML||""),s&&(d=a(s,i),d!==!1&&$(c[g]).replaceWith(d));return l.html()},I=function(e){return o.getTweetContent(e[1])},b=function(e){return o.getInstagramPostContent(e[1])},R=function(t,n){var a,i=e.commentBlockquoteDayRegex.exec(t[3]);return i?(a=new Date(n.postDate.getFullYear(),moment(i[2],"MMMM").format("M")-1,i[1],i[3],i[4],0,0),a.getTime()>n.postDate.getTime()&&a.setYear(a.getYear()-1)):(i=e.commentBlockquoteTimeRegex.exec(t[3]),i&&(a=new Date(n.postDate),a.setHours(i[1]),a.setMinutes(i[2]),a.getTime()>n.postDate.getTime()&&a.setDate(a.getDate()-1))),a?o.getCommentContent(t[2],a,t[1],n.postDate.toDateString()===a.toDateString()):(i=e.commentBlockquoteFullDayRegex.exec(t[6]),!!i&&(a=new Date(i[3],moment(i[2],"MMMM").format("M")-1,i[1],i[4],i[5],0,0),o.getCommentContent(t[5],a,t[4],n.postDate.toDateString()===a.toDateString())))},A=function(e,t){var n="",o=e.length;if(o>0){for(n='<div class="Media">';o;)o--,e[o].Url&&e[o].Type&&"IMAGE"===e[o].Type&&(n+='<img src="'+e[o].Url+'" />');t&&(n+='<div class="Caption">'+t+"</div>"),n+="</div>"}return n},S=function(t){if(!t.match(e.sliderRegex))return t;for(var n,a=$("<div>"+t+"</div>"),i=a.find(".SL_SlideShow"),r=i.length;r;)r--,n=[],$(i[r]).find(".MediaWrap").each(function(t,o){n.push(o.innerHTML.replace(e.styleAttributeRegex,""))}),$(i[r]).replaceWith(o.getSliderContent(n));return a.html()},L=function(o){t.getEvent({UserName:o.pseudonym,Content:o.comment,Token:e.postToken,format:"json"}).done(function(e){200===e.Code?n.send("commentSent"):n.send("commentSendingFailed")}).fail(function(){n.send("commentSendingFailed")})};return{pageInitialization:function(e,o){s=e,l=o,t=t(s),$.getScript("http://embed.scribblelive.com/modules/lib/addons.js?id="+e),p(),n.listen("oldPostsDisplayed",f),n.listen("postComment",function(e,t){L(t)})},refreshFactsContent:C,getPostData:h}});
/* -- end module lmd/module/live2/providers/scribblelive -- */
/* -- start module lmd/util/url-tools -- */
define("lmd/util/url-tools",{toUrlFriendly:function(e){"use strict";e=e.toLowerCase(),e=this.clean(e);for(var r="",a="",l=e.length,c=0;c<l;c++){var g=e.charCodeAt(c);a=g<48||g>122||g>57&&g<97?"-":e.charAt(c),r+=a}return r=r.replace(/\-+/g,"-")},parseQueryString:function(e){"use strict";for(var r=e.split("&"),a=null,l={},c=0;c<r.length;c++)a=r[c].split("="),a.length>1?l[a[0]]=a[1]:l[a[0]]=null;return l},clean:function(e){"use strict";return e=e.replace(/\xE0/g,"a"),e=e.replace(/\xE1/g,"a"),e=e.replace(/\xE2/g,"a"),e=e.replace(/\xE3/g,"a"),e=e.replace(/\xE4/g,"a"),e=e.replace(/\xE5/g,"a"),e=e.replace(/\xE6/g,"a"),e=e.replace(/\xE7/g,"c"),e=e.replace(/\xE8/g,"e"),e=e.replace(/\xE9/g,"e"),e=e.replace(/\xEA/g,"e"),e=e.replace(/\xEB/g,"e"),e=e.replace(/\xEC/g,"i"),e=e.replace(/\xED/g,"i"),e=e.replace(/\xEE/g,"i"),e=e.replace(/\xEF/g,"i"),e=e.replace(/\xF0/g,"o"),e=e.replace(/\xF2/g,"o"),e=e.replace(/\xF3/g,"o"),e=e.replace(/\xF4/g,"o"),e=e.replace(/\xF5/g,"o"),e=e.replace(/\xF6/g,"o"),e=e.replace(/\xF1/g,"n"),e=e.replace(/\xF9/g,"u"),e=e.replace(/\xFA/g,"u"),e=e.replace(/\xFB/g,"u"),e=e.replace(/\xFC/g,"u"),e=e.replace(/\xFD/g,"y"),e=e.replace(/\xFF/g,"y")},normalize:function(e){"use strict";return e=this.clean(e),e=e.replace(/[^a-zA-Z0-9]/g,"_")}});
/* -- end module lmd/util/url-tools -- */
/* -- start module lmd/ui/sharing -- */
define("lmd/ui/sharing",function(require){"use strict";function t(t){this.$el=$(t)}var $=require("jquery"),e=require("lmd/core/conf"),r=require("lmd/core/context"),i=require("lib/object-path"),n=require("lmd/module/xiti/hit");require("lib/jquery/plugin/jquery.spin");var o=require("lmd/core/social/facebook");return t.prototype.xtClick=function(t,e,o){var a=t.getAttribute("data-xiti-label");if(!a){var l=i.get(r,"item.titre");if(!l)return;a="Partage::"+e+"::"+l}return"undefined"==typeof o&&(o="A"),n.hit(t,"C","",a,o),!1},t.prototype.getPageUrl=function(t,i){var n=e.www.location.hostname,o="http://"+n+r.page.link;return"string"==typeof t&&""!==t&&(o+="#xtor="+t),"boolean"==typeof i&&i===!1?o:encodeURI(o)},t.prototype.openPopupShare=function(t,e){var r="undefined"!=typeof e.width?e.width:650,i="undefined"!=typeof e.height?e.height:430,n=($(window).width()-r)/2,o=($(window).height()-i)/2,a="width="+r+",height="+i+",top="+o+",left="+n;a+=",location=no,resizable=yes,status=no,titlebar=no,toolbar=no",window.open(t,"toolbar_share_popup",a)},t.prototype.getSpecificUrl=function(t,e,r){var i,n;return i=$(t.data("sharing-target")),i&&void 0!==i&&(n=i.data("sharing-url"),n&&void 0!==n)?("string"==typeof e&&""!==e&&(n+="#xtor="+e),r?encodeURIComponent(n):n):null},t.prototype.init=function(){var t=this,e=$('meta[property="og:image"]').attr("content");this.$el.on("click","[data-sharewith=facebook]",function(r){r.preventDefault(),t.xtClick(r.currentTarget,"Facebook");var i=t.getSpecificUrl($(r.currentTarget),"",!1);null===i&&(i=t.getPageUrl("",!1)),o.load().done(function(){FB.ui({method:"feed",link:i,picture:e})})}),this.$el.on("click","[data-sharewith=twitter]",function(e){e.preventDefault(),t.xtClick(e.currentTarget,"Twitter");var i=t.getSpecificUrl($(e.currentTarget),"AL-32280258",!0);null===i&&(i=t.getPageUrl("AL-32280258",!0));var n="http://twitter.com/share?related=lemondefr&via=lemondefr&lang=fr&text=",o=$("<div />").html(r.item.titre).text(),a=n+encodeURIComponent(o)+"&url="+i;t.openPopupShare(a,{width:550,height:443})}),this.$el.on("click","[data-sharewith=linkedin]",function(e){t.xtClick(e.currentTarget,"Linkedin");var i=t.getPageUrl("AL-32280506",!0),n="http://www.linkedin.com/shareArticle?mini=true&url=",o=n+i+"&title="+encodeURIComponent(r.item.titre)+"&source=LeMonde.fr";t.openPopupShare(o,{width:550,height:590})}),this.$el.on("click","[data-sharewith=google-plus]",function(e){t.xtClick(e.currentTarget,"Google+");var r="https://plus.google.com/share?hl=fr&url="+t.getPageUrl("",!0);t.openPopupShare(r,{width:600,height:855})}),this.$el.on("click","[data-sharewith=pinterest]",function(i){t.xtClick(i.currentTarget,"Pinterest");var n=t.getPageUrl("",!0),o="https://www.pinterest.com/pin/create/button/?url=",a=o+n+"&description="+encodeURIComponent(r.item.titre);"undefined"!=typeof e&&null!==e&&(a=a+"&media="+e),t.openPopupShare(a,{width:750,height:330})}),this.$el.on("click","[data-sharewith=link]",function(e){e.preventDefault(),t.xtClick(e.currentTarget,"Lien");var r=$(e.currentTarget);if(0===r.find(".link-sharing-popin").length){var i=t.getSpecificUrl(r,"",!1);null===i&&(i=t.getPageUrl("",!1));var n=require("hoganpower!/partials/social/link-sharing-popin.html.mu@www"),o=$(n.render({link:i}));o.mouseleave(function(t){$(t.currentTarget).remove()}),$(e.currentTarget).append(o),o.find("input").focus().select()}})},{init:function(e){$(e).each(function(){if("undefined"==typeof $(this).data("lmd-sharing")){var e=new t(this);e.init(),$(this).data("lmd-sharing",!0)}})},formatCounter:function(t){var e="";return t>=1e5&&(t=Math.floor(t/1e3),e="k"),t>=1e3&&(t=Math.floor(t/1e3)+" "+t.toString().substr(-3)),t+e},getFacebookLikes:function(){var e=$.Deferred();return $.ajax({url:"http://graph.facebook.com",dataType:"json",data:{id:t.prototype.getPageUrl()},timeout:2e3,success:function(t){void 0!==t.share.share_count?e.resolve(t.share.share_count):e.resolve(0)},error:function(){e.resolve(0)}}),e}}});
/* -- end module lmd/ui/sharing -- */
/* -- start module lmd/module/live2/page/comment-form -- */
define("lmd/module/live2/page/comment-form",["lmd/module/live2/page/events","jquery"],function(n,$){"use strict";function e(){0===o.$form.find(":invalid").length?o.$submitButton.removeAttr("disabled"):o.$submitButton.attr("disabled","disabled")}function t(n){return{$container:n,$form:$("form",n),$comment:$("[name=comment]",n),$spinners:$(".spinner",n),$notifications:$(".notification",n),$notificationContainers:$(".notification-container",n),$submitButton:$("button[type=submit]",n),notify:function(n){o.$notifications.html(n),o.$notificationContainers.fadeIn(400).delay(3e3).fadeOut(400)},onCommentSent:function(){o.$comment.val(""),r&&$(".post-comment-container form").trigger("reset"),e(),o.$spinners.unspin(),o.notify("Merci, votre contribution a bien été envoyée !")},onCommentSendingFailed:function(){o.$spinners.unspin(),o.notify("Une erreur est survenue, veuillez réessayer ultérieurement")}}}function i(){o.$form.on("submit",function(e){e.preventDefault();var t={comment:e.target.comment.value,pseudonym:e.target.pseudonym.value};o.$spinners.spin({height:10,spRadius:3,spWidth:2,spLength:4,spLines:10}),n.send("postComment",t),n.listen("commentSent",o.onCommentSent),n.listen("commentSendingFailed",o.onCommentSendingFailed)}),o.$form.on("keyup",e),o.$form.on("click",e)}var o,r=!1;return{getPluggedForm:function(n,e){if(o)throw new Error("Comment form already initialised");return r=e,o=t(n),i(),o}}});
/* -- end module lmd/module/live2/page/comment-form -- */
/* -- start module lmd/module/live2/page/events -- */
define("lmd/module/live2/page/events",["jquery"],function($){"use strict";var e,n={},t=["newPostsAvailable","oldPostsAvailable","postsDeleted","newFactsContent","displayCommentForm","commentSent","commentSendingFailed","oldPostsDisplayed","postComment"];return n.send=function(n,o){if(t.indexOf(n)===-1)throw new Error("Event "+n+" cannot be triggered");e.trigger(n,o)},n.listen=function(n,o){if(t.indexOf(n)===-1)throw new Error("Event "+n+" cannot be listened to");e.on(n,o)},e=$(n),{send:e.get(0).send,listen:e.get(0).listen}});
/* -- end module lmd/module/live2/page/events -- */
/* -- start module lmd/module/live2/page/formatters -- */
define("lmd/module/live2/page/formatters",["hoganpower!/partials/element/live2/slider.html.mu@www","hoganpower!/partials/element/live2/post.html.mu@www","lmd/util/url-tools","lmd/core/conf","lib/crypto/core/md5","lib/moment/langs/fr","lmd/module/live2/page/store","jquery","lib/moment/core/2.0.0/moment"],function(t,e,n,r,a,o,i,$){"use strict";function m(t){return parseInt(t.format("YYYYMMDD"),10)}function l(t){var e=window.location.search,a={highlight:t};return e&&(e=e.replace(p,""),a=$.extend(a,n.parseQueryString(e))),"http://"+r.www.location.hostname+window.location.pathname+"?"+$.param(a)}function d(t,e){var n="";return moment().diff(t,"minutes")<h?t.fromNow():(e&&(n=n+"le "+t.format("D MMMM ")),n+"à "+t.format("HH")+"h"+t.format("mm"))}function s(t){var n=moment(t.createdAt),r=$.extend({mainPost:!0,fullTimeFormat:!0},t,{time:t.createdAt.getTime(),date:d(n,t.fullTimeFormat||!0),day:{id:m(n),content:n.format("dddd D MMMM")},hash:a(JSON.stringify(t)),url:l(t.id),content:t.content.replace(w,"")});return i.days.merge(r.day.id),$(e.render(r))}function c(t){return'<div class="tweet" data-tweet-id="'+t+'"></div>'}function u(t){return'<div class="instagram"><blockquote class="instagram-media" data-instgrm-captioned data-instgrm-version="4"><a href="https://instagram.com/p/'+t+'/"></a></blockquote></div>'}function f(e){return t.render({slides:e})}function g(t,e,n,r){var a={type:"html",mainPost:!1,createdAt:e,author:{name:t,avatar:null},content:n};return r||(a.fullTimeFormat=!0),s(a)}var p=/^\?/,w=/^(?:\s|<br ?\/?>)*|(?:\s|<br ?\/?>)*$/g,h=44;return moment.lang("fr",o),{getTweetContent:c,getInstagramPostContent:u,getSliderContent:f,getCommentContent:g,getDayId:m,getDisplayedDate:d,createPost:s}});
/* -- end module lmd/module/live2/page/formatters -- */
/* -- start module lmd/module/live2/page/store -- */
define("lmd/module/live2/page/store",function(){"use strict";var n=function(){var n=[];return{merge:function(t){n.indexOf(t)===-1&&n.push(t)},backwardIterate:function(t){for(var r=n.length;r;)r--,t(n[r],r)}}}(),t=function(){var n=0;return{add:function(t){n+=t},reset:function(){n=0},get:function(){return n}}}(),r=function(){var n=[];return{push:function(t){return n.indexOf(t)===-1?(n.push(t),1):0},list:function(){return n}}}();return{days:n,newPostCount:t,postIds:r}});
/* -- end module lmd/module/live2/page/store -- */
/* -- start module lmd/module/live2/providers/scribblelive/conf -- */
define("lmd/module/live2/providers/scribblelive/conf",["lmd/core/conf"],function(e){"use strict";function t(e){return" class=(['][^']*"+e+"[^']*[']|[\"][^\"]*"+e+'[^"]*["])'}return{endpoint:e.live2Scribblelive.endpoint,postToken:e.live2Scribblelive.token,postsRefreshRate:1e3*e.live2Scribblelive.postsRefreshDelay,factsRefreshDelay:1e3*e.live2Scribblelive.factsRefreshDelay,ajaxDefaultParameters:{token:e.live2Scribblelive.token,format:"json",pageSize:e.live2Scribblelive.pageSize},dateRegex:/^\/Date\(([0-9]{13}\+[0-9]{4})\)\/$/,htmlTagsRegex:/(<([^>]+)>)/gi,sliderRegex:t("SL_SlideShow"),tweetIdRegex:/https?:\/\/twitter\.com\/[^\/]+\/status\/(\d+)/im,instagramPostIdRegex:/https?:\/\/(?:www\.)?instagram\.com\/p\/([^\/"']+)/im,commentBlockquoteRegex:/(?:<span[^>]*>(.*)<\/span><span[^>]*>.*<span[^>]*>(.*)<\/span>.*<span[^>]*>[^ ]* (.*)<\/span><\/span>|<span[^>]*>(.*)<img.*<em>(.*)<\/em><span[^>]*>(.*)<\/span><\/span>)/im,aTagRegex:/<a /gim,aTagRegexKeepLink:/<a .*href="(http:\/\/.*\.lemonde\.fr[^"]+)"/,imgTagRegex:/<img .*src="[^"]+"[^>]*>/,commentBlockquoteDayRegex:/^(\d{1,2}) (\w+) à (\d{1,2}) h (\d{1,2}) $/,commentBlockquoteFullDayRegex:/^(?:\w+) (\d{1,2}) (\w+) (\d{4}) à (\d{1,2}):(\d{1,2})$/,commentBlockquoteTimeRegex:/^à? ?(\d{1,2}):(\d{1,2})$/,styleAttributeRegex:/style="[^"]*"/gim,blacklistAttributes:[/(<[^>]+)contenteditable="true"([^>]+)?(>)/,"$1$2$3"],getClassnameRegex:t}});
/* -- end module lmd/module/live2/providers/scribblelive/conf -- */
/* -- start module lmd/module/live2/providers/scribblelive/api -- */
define("lmd/module/live2/providers/scribblelive/api",["lmd/module/live2/providers/scribblelive/conf","jquery"],function(e,$){"use strict";function t(){var t=isNaN(s.get())?s.get():s.get()-1;return $.getJSON([e.endpoint,"event",o,"page",t].join("/"),e.ajaxDefaultParameters).done(function(e){u||(s.init(e.Pages-1),u=!0)})}function n(t){var n=$.extend({},e.ajaxDefaultParameters,{since:t});return $.getJSON([e.endpoint,"event",o,"posts",""].join("/"),n)}function i(t){return $.getJSON([e.endpoint,"post",t,""].join("/"),e.ajaxDefaultParameters)}function r(t){return $.getJSON([e.endpoint,"event",o].join("/"),t||e.ajaxDefaultParameters)}function a(t){return $.getJSON([e.endpoint,"article",t,"revision/published/latest"].join("/"),e.ajaxDefaultParameters)}var o="",u=!1,s=function(){var e="last",t=new Date(0);return{next:function(){return!isNaN(e)&&e>0?(--e,e):null},init:function(t){isNaN(e)&&(isNaN(t)||(e=t))},setModified:function(e){e.setSeconds(e.getSeconds()+1),t=e},getModified:function(){return t},get:function(){return e}}}();return function(e){return o=e,{getPage:t,getPostsSince:n,getPostData:i,getEvent:r,getLiveArticle:a,page:s}}});
/* -- end module lmd/module/live2/providers/scribblelive/api -- */