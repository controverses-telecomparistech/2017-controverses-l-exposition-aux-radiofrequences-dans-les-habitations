define(function(require){"use strict";function e(){var e=document.documentElement.clientWidth;return e<728?"mobile":e<=1e3?"tablet":"desktop"}function t(e){for(var t=window.location.search.substring(1),o=t.split("&"),n=0;n<o.length;n++){var i=o[n].split("=");if(decodeURIComponent(i[0])===e)return decodeURIComponent(i[1])}return""}function o(){var e=/lmd_force_dfp=([^&]+)/.exec(window.location.search)||!1;return e!==!1&&("true"===e[1]?b.set("lmdDPFDebugMode",!0):b.remove("lmdDPFDebugMode")),b.get("lmdDPFDebugMode")}function n(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var i=o[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}function i(){try{var e=(document.cookie.match("(^|; )info_user_web=([^;]*)")||0)[2];if(void 0!==e&&null!==e&&""!==e&&(e=JSON.parse(decodeURIComponent(e)),void 0!==e&&null!==e&&""!==e))return e.info_user.type_abo_oas}catch(e){console.debug("error while accessing document.cookie : "+e.message)}return null}function d(){var e,t,o=[];if(void 0!==lmd&&void 0!==lmd.context&&"Rubrique"===lmd.context.pageType&&void 0!==lmd.context.rubrique&&null!==lmd.context.rubrique&&o.push(lmd.context.rubrique.url_friendly),void 0!==lmd&&void 0!==lmd.context&&"Element"===lmd.context.pageType&&void 0!==lmd.context.rubriques&&null!==lmd.context.rubriques)for(e=lmd.context.rubriques.length,t=0;t<e;t++)o.push(lmd.context.rubriques[t].url_friendly);return o}function l(){return void 0!==lmd&&void 0!==lmd.context&&void 0!==lmd.context.item&&null!==lmd.context.item&&void 0!==lmd.context.item.id&&null!==lmd.context.item.id?lmd.context.item.id:null}function r(){return void 0!==lmd&&void 0!==lmd.context&&void 0!==lmd.context.rubrique&&null!==lmd.context.rubrique&&void 0!==lmd.context.rubrique.id&&null!==lmd.context.rubrique.id?lmd.context.rubrique.id:null}function a(){return void 0!==lmd&&void 0!==lmd.context&&void 0!==lmd.context.item&&null!==lmd.context.item&&void 0!==lmd.context.item.has_atome_video&&null!==lmd.context.item.has_atome_video&&lmd.context.item.has_atome_video}function u(){return void 0!==lmd&&void 0!==lmd.context&&void 0!==lmd.context.item&&null!==lmd.context.item&&void 0!==lmd.context.item.gabarit&&"singlecol"===lmd.context.item.gabarit}function g(){return void 0!==lmd&&void 0!==lmd.context&&void 0!==lmd.context.item&&null!==lmd.context.item&&void 0!==lmd.context.item.type&&void 0!==lmd.context.item.type.libelle&&lmd.context.item.type.libelle}function c(){y.user_type=i(),y.rubriques=d(),y.rubrique_id=r(),y.item_id=l(),y.article_has_video=a(),y.article_is_longform=u(),y.article_type=g()}function m(){s=lmd.context.page.dfp.device,"responsive"===s&&(s=e()),googletag.cmd.push(function(){[].forEach.call(T,function(e){f=e.getAttribute("data-format"),"undefined"!=typeof x[f]&&x[f][s].length>0&&("out-of-page"===x[f][s][0][0]?googletag.defineOutOfPageSlot(_+f,h+f).setTargeting("pos",f).addService(googletag.pubads()):googletag.defineSlot(_+f,x[f][s],h+f).setTargeting("pos",f).setCollapseEmptyDiv(!0).addService(googletag.pubads()))});var e=0;"undefined"!=typeof performance&&"undefined"!=typeof performance.navigation?e=performance.navigation.type:document.referrer===window.location.href&&(e=1),googletag.pubads().setTargeting("nt",""+e),googletag.pubads().setTargeting("rub",[lmd.context.page.dfp.section,lmd.context.page.dfp.subSection]),googletag.pubads().setTargeting("keywords ",[lmd.context.page.dfp.section,lmd.context.page.dfp.subSection]);var o=t("dfptest");""!==o&&googletag.pubads().setTargeting("test",o);for(var i in y)y.hasOwnProperty(i)&&(Array.isArray(y[i])||googletag.pubads().setTargeting(i,[y[i]]),Array.isArray(y[i])&&googletag.pubads().setTargeting(i,y[i]));""!==n("lmd_beta")&&googletag.pubads().setTargeting("echantillon","refonte"),""!==n("lmd_default")&&googletag.pubads().setTargeting("echantillon","default"),""!==n("lmd_temoin")&&googletag.pubads().setTargeting("echantillon","temoin"),googletag.pubads().enableSingleRequest(),googletag.pubads().collapseEmptyDivs(),googletag.enableServices(),googletag.pubads().addEventListener("slotRenderEnded",function(e){var t,o,n=document.getElementById(e.slot.getSlotElementId());n&&(t=n.getAttribute("data-format"),o=x[t][s],o&&"out-of-page"!==o[0][0]&&(e.isEmpty===!0||e.size&&"1,1"===e.size.toString())&&(n.style.display="none"))}),[].forEach.call(T,function(e){var t=e.getAttribute("data-format");"undefined"!=typeof x[t]&&x[t][s].length>0&&googletag.display(h+t)})})}var s,f,p=require("lmd/core/conf"),v=require("lmd/core/context"),b=require("lmd/core/storage"),x=[],_="",h="dfp-",y=[];v.page&&v.page.dfp&&(x=JSON.parse(v.page.dfp.formats),_=v.page.dfp.tag);var q=["banniere_haute","pave_haut","habillage","oreille_gauche","oreille_droite","pave_milieu","pave_bas","parallaxe","dhtml","banniere_basse"],T=[].slice.call(document.getElementsByClassName("dfp_slot")).sort(function(e,t){var o=e.getAttribute("data-format"),n=t.getAttribute("data-format"),i=q.indexOf(o),d=q.indexOf(n);return i===-1?1:d===-1?-1:i<d?-1:1});(o()||p.fsw.dfp)&&"undefined"!=typeof googletag&&(c(),m())});