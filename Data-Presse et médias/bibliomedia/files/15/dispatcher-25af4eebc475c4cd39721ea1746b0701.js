/**
 * Package www/dispatcher
 * lmd/module/priority-dispatcher
 * lmd/data/meter
 * lmd/core/ux/outbrain
 * lmd.meter
 */

/* -- start module lmd/module/priority-dispatcher -- */
define("lmd/module/priority-dispatcher",function(require){"use strict";var $=require("jquery"),e=require("lmd/data/meter"),n={meter:e.isEnabled()&&e.maxReached()},t=new $.Deferred,r={outbrain:["meter"]},a=[],i=function(e){e.active&&a.push(e.name)};return function(e,c){var o,u=0,f=0,d=[];e(r,function(e,t){for(d=[],u=0,f=t.length;u<f;u++){if(o=n[t[u]],"object"!=typeof o){i({active:o,name:e});break}d.push(o),o.done(i)}}),c(d).then(function(){t.resolve(a)})}($.each,$.when),t});
/* -- end module lmd/module/priority-dispatcher -- */
/* -- start module lmd/data/meter -- */
define("lmd/data/meter",function(require){"use strict";var e=require("lmd/core/conf"),t=require("lmd/core/context"),i=require("lmd/core/storage"),n=require("lib/object-path"),r={readItemKey:"us_meter_readed",activatedKey:"us_meter_activation",simulationKey:"us_meter_simulation"},a=function(){return null!==i.get(r.simulationKey)},s=n.get(e,"us_meter.quota_per_month")||1e3,u=function(){return this.isEnabled=function(){var s=!1;return this.isEnabled=function(){return s},a()?s=!0:n.get(e,"fsw.us_meter")&&null!==i.get(r.activatedKey)&&(s=!0),s&&(s=function(){var i=n.get(e,"us_meter.application")||[],r=n.get(e,"us_meter.page_type")||[];return i.indexOf(t.application)>-1&&r.indexOf(t.pageType)>-1}()),s},this.maxReached=function(){return!!(this.readItemIds&&this.readItemIds.length>=s)},this.keys=r,this.readItemIds=JSON.parse(i.get(r.readItemKey))||[],this.isSimulated=a,this};return new u});
/* -- end module lmd/data/meter -- */
/* -- start module lmd/core/ux/outbrain -- */
define("lmd/core/ux/outbrain",function(require){"use strict";function t(t){if(void 0!==t.id&&e(t.options)){var n=document.createElement("div");return n.setAttribute("class","OUTBRAIN"),n.setAttribute("data-src","http://"+d+u),n.setAttribute("data-widget-id",t.id),n.setAttribute("data-ob-template","lemonde"),n}}function e(t){if(!t)return!0;if(t.minWidth||t.maxWidth){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(t.minWidth&&t.minWidth>e)return!1;if(t.maxWidth&&t.maxWidth<=e)return!1}return!0}var n=require("lmd/core/context"),i=require("lmd/core/conf"),r=require("lib/object-path"),o=require("lmd/module/priority-dispatcher"),d="www.lemonde.fr",u=r.get(lmd,"context.page.link"),a=function(){var t=document.createElement("script");t.async=!0,t.src="//widgets.outbrain.com/outbrain.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]||document.getElementsByTagName("script")[0].parentNode).insertBefore(t,null)},c=function(){var t,e,r=0,d=!0;if(i.featureSectionBlacklist.outbrain)for(e=n.getSectionNameList(),t=e.length;r<t;r++)if(i.featureSectionBlacklist.outbrain.indexOf(e[r])!==-1){d=!1;break}return d&&o.done(function(t){t.indexOf("outbrain")===-1&&a()}),d},m=function(){return lmd.conf.fsw.outbrain&&["Element","Rubrique","Rubrique_Une"].indexOf(lmd.context.pageType)!==-1?c:function(){return!1}},l=function(e,n,i){var r=document.getElementById(e);if(0!==r.length){for(var o=!1,d=n.length,u=0;u<d;u++){var a=t(n[u]);a&&(r.appendChild(a),o=!0)}o||f(r),o&&i!==!1&&c()}},f=function(t){var e=t.parentNode;e.removeChild(t)};return{load:m(),insertTags:function(){return lmd.conf.fsw.outbrain&&u?l:function(t){return f(document.getElementById(t)),!1}}()}});
/* -- end module lmd/core/ux/outbrain -- */
/* -- start module lmd.meter -- */
define("lmd.meter",function(require){"use strict";function e(){r(),f.isEnabled()&&(f.maxReached()?n():(t(),d(),a()))}function t(){var e=g.get(u,"element.id"),t=g.get(u,"pageType"),a=g.get(u,"element.type.nom"),n=g.get(u,"element.restreint");if(/^\d+$/.test(e)&&"Element"===t&&"article"===a&&n===!0){var r=["overlay",e,"us_meter"].join("/"),i={dataType:"json",timeout:1e4};c.get(r,1,{},i).then(function(e){$(".js_article_body").html(e.element),$(".js_teaser_article").detach()})}}function a(){var e=g.get(l,"us_meter.display_toaster"),t=lmd.usMeter.readItemIds.length.toString(),a=y.toString(),n=e.indexOf(t)+1;(e.indexOf(t)>-1||parseInt(a,10)===parseInt(t,10))&&(g.get(l,"fsw.us_meter_display")===!0&&($("body").append(w.render({readNumber:t,limit:a,isLast:parseInt(t,10)>=parseInt(a,10),key:_?"TOASTERWEB":"TOASTERMOB",step:n})),$(".js_meter_toaster").on("click",".bt_fermer_rond",function(){$(".js_meter_toaster").remove()})),o("Affichage_Toaster::affichage_"+n),s("INT-43-"+n))}function n(){var e=y.toString();g.get(l,"fsw.us_meter_display")===!0&&($(".js_meter_global").append(I.render({limit:e,key:_?"PAYWALLWEB":"PAYWALLMOB"})),$(window).scrollTop(0),$("#video_container").remove()),o("Affichage_wall"),s("INT-42")}function r(){window.lmd=lmd||{},window.lmd.usMeter={activated:f.isEnabled(),simulated:f.isSimulated(),readItemIds:f.readItemIds}}function i(e){e===!0?(h=!0,p.set(f.keys.simulationKey,!0),console.debug("US Meter simulation activated")):(h=!1,p.remove(f.keys.simulationKey),console.debug("US Meter simulation desactivated")),r()}function d(){window.lmd=lmd||{},lmd.usMeter.readItemIds=lmd.usMeter.readItemIds||[],lmd.usMeter.readItemIds.indexOf(u.item.id)===-1&&f.isEnabled()&&(lmd.usMeter.readItemIds.push(u.item.id),p.set(f.keys.readItemKey,JSON.stringify(lmd.usMeter.readItemIds),m()))}function o(e){"function"==typeof window.xt_med&&window.xt_med("C","",e,"A")}function m(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59);return t-e}function s(e){var t="http://logc2.xiti.com/get.ad?xts=43260&ati="+e+"&type=AT&z="+(new Date).getTime();$("<img/>").appendTo("body").attr("src",t)}require("hoganpower");var $=require("jquery"),l=require("lmd/core/conf"),u=require("lmd/core/context"),c=require("lmd/core/service"),p=require("lmd/core/storage"),f=require("lmd/data/meter"),g=require("lib/object-path"),_="www"===u.application,w=require("hoganpower!/templates/module/meter/toaster.html.mu"),I=require("hoganpower!/templates/module/meter/wall.html.mu"),y=g.get(l,"us_meter.quota_per_month")||1e3,h=f.isSimulated();return{launch:e,simulate:i}});
/* -- end module lmd.meter -- */